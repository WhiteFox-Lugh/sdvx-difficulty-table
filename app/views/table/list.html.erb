<h1>SDVX Lv. <%= @level %></h1>

<% if logged_in? %>
  <p>Your ID : <%= @current_user.uid %></p>
<% end %>

<table class="table table-striped">
  <thead>
    <tr>
      <th scope="col">No.</th>
      <th scope="col">jacket</th>
      <th scope="col">title</th>
      <th scope="col">ver</th>
      <th scope="col">chain</th>
      <th scope="col">S許容</th>
      <th scope="col">995許容</th>
      <th scope="col">998許容</th>
      <% if logged_in? %>
        <th scope="col">score</th>
        <th scope="col">medal</th>
      <% end %>
    </tr>
  </thead>
  <tbody>
  <% puc = 1000 %>
  <% b_990 = 990 %>
  <% b_995 = 995 %>
  <% b_998 = 998 %>
  <% @tunes.each do |t| %>
    <tr>
      <td>
        <%= t.id %>
      </td>
      <td>
        <img src="<%= t.jacket_img_url %>" class="img-flued" alt="Thumbnail" width="50px" height="50px">
      </td>
      <th scope="row">
      <%= t.title %>
      </th>
      <td><%= t.version %></td>
      <td><%= t.chain %></td>
      <td><%= (((puc - b_990) * 2 * t.chain) / puc).floor %></td>
      <td><%= (((puc - b_995) * 2 * t.chain) / puc).floor %></td>
      <td><%= (((puc - b_998) * 2 * t.chain) / puc).floor %></td>
      <% if logged_in? %>
        <% score_map = {0 => "None", 1 => "AAA", 2 => "AAA+", 3 => "S", 4 => "995", 5 => "998", 6 => "PERFECT"} %>
        <% medal_map = {0 => "None", 1 => "Clear", 2 => "EX-Clear", 3 => "UC", 4 => "PUC"} %>
        <% tune_no = t.id %>
        <% record = @achieve_map[tune_no] %>
        <% score_str = if record == nil then score_map[0] else score_map[record[0]] end %>
        <% medal_str = if record == nil then medal_map[0] else medal_map[record[1]] end %>
        <td>
          <%= score_str %>
        </td>
        <td>
          <%= medal_str %>
        </td>
      <% end %>
    </tr>
  <% end %>
  </tbody>
</table>